<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vinix 7 — Asisten Digital (Gabungan Final)</title> 

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>

    <style>
        /* ========================================= */
        /* === BAGIAN CSS START === */
        /* ========================================= */
   /* Warna VINIX */
        :root {
            --vinix-blue-dark: #1a4c90; /* Biru gelap VINIX (untuk teks dan tombol) */
            --vinix-glow-color: #4c8aeb; /* Biru terang untuk efek neon/glow */
            --particle-star-color: #4c8aeb; /* Biru tua untuk bintang/partikel */
            --bg:#FFFFFF; 
            --card-bg:#F8F9FA; 
            --text-main:#333333; 
            --primary:#FFC300; 
            --accent:#1E5EAE; 
            --muted:#6c757d; 
            --delete-red: #dc3545; /* Variabel CSS yang jadi masalah di JS */
        }
        
        * {
            box-sizing: border-box;
        }

        body, html {
            margin: 0;
            padding: 0;
            font-family: 'Poppins', 'Segoe UI', sans-serif;
            height: 100vh;
            overflow: hidden; /* Awalnya hidden untuk layar login/register */
        }

        #particles-js {
            position: absolute;
            width: 100%;
            height: 100%;
            background: white; 
            z-index: 0;
        }
        
        /* MENGHILANGKAN KUNING AUTOFILl */
        input:-webkit-autofill,
        input:-webkit-autofill:hover, 
        input:-webkit-autofill:focus, 
        input:-webkit-autofill:active {
            -webkit-box-shadow: 0 0 0 1000px white inset !important; 
            -webkit-text-fill-color: var(--vinix-blue-dark) !important; 
            transition: background-color 5000s ease-in-out 0s; 
        }

        .login-box {
            position: relative;
            z-index: 1;
            width: 95%;
            max-width: 400px;
            margin: auto;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.98); 
            border-radius: 20px;
            
            box-shadow: 0 0 10px var(--vinix-glow-color), 
                        0 0 20px var(--vinix-glow-color),
                        0 12px 25px rgba(0, 0, 0, 0.15); 
            
            padding: 30px;
            text-align: center;
        }

        /* Logo/Ikon */
        .logo-container {
            margin-bottom: 20px;
        }
        .logo-container img {
            width: 150px;
            height: auto;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        .login-box h5 { 
            color: var(--vinix-blue-dark);
            margin-bottom: 25px;
            text-shadow: 0 0 5px rgba(46, 159, 240, 0.5); 
        }

        .form-control {
            border-radius: 10px;
            margin-bottom: 15px;
            transition: box-shadow 0.3s ease;
        }
        .form-control:focus {
            border-color: var(--vinix-glow-color);
            box-shadow: 0 0 8px rgba(76, 138, 235, 0.6);
        }

        /* Tombol Login */
        .btn-login {
            background-color: var(--vinix-blue-dark);
            border: none;
            color: white;
            border-radius: 10px;
            padding: 10px;
            font-weight: bold;
            width: 100%;
            transition: 0.3s ease, box-shadow 0.3s ease;
            
            box-shadow: 0 0 5px var(--vinix-glow-color);
        }

        .btn-login:hover {
            background-color: var(--vinix-glow-color); 
            box-shadow: 0 0 15px var(--vinix-glow-color);
        }
        
        .footer-links {
            margin-top: 15px;
            font-size: 14px;
        }

        .footer-links a {
            color: var(--vinix-blue-dark);
            text-decoration: none;
            margin: 0 5px;
        }

        .footer-links a:hover {
            text-decoration: underline;
        }

        /* GAYA KONTEN UTAMA (MAIN-CONTENT) */
        .container{max-width:1100px;margin:32px auto;padding:24px}
        .muted{color:var(--muted);font-size:13px}
        .flex-1 { flex: 1; }

        /* HEADER DAN NAVIGASI UTAMA */
        header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
        .brand{display:flex;gap:12px;align-items:center}
        .logo-img{ width: 180px; height: auto; margin-right: 0;}
        .logo-text { font-size: 24px; font-weight: 700; color: var(--accent); }
        h1{font-size:20px;margin:0}
        nav{display:flex;gap:8px}

        /* Tombol Tab Utama */
        .tab{
            background:transparent;
            border:1px solid var(--muted); 
            padding:8px 14px;
            border-radius:10px;
            cursor:pointer;
            color:var(--muted);
            transition: all 0.2s;
        }
        .tab.active{
            background:var(--accent); 
            border:1px solid var(--accent);
            color:white; 
        }
        
        /* GAYA UMUM GRID DAN CARD */
        .grid{display:grid;grid-template-columns:1fr 360px;gap:16px}
        .card{
            background:var(--card-bg);
            border-radius:12px;
            padding:18px;
            margin-top:12px;
            border: 1px solid #dee2e6;
            box-shadow: 0 0 10px rgba(30, 94, 174, 0.1), 
                        0 4px 12px rgba(0,0,0,0.05); 
        }
        .card-inner { margin-top: 12px; }

        /* INPUT DAN TOMBOL */
        .row{display:flex;gap:8px}
        input,select,textarea{
            width:100%;
            padding:10px;
            border-radius:8px;
            border:1px solid var(--muted);
            background:white;
            color:var(--text-main);
        }
        label {
            display: block;
            margin-top: 8px;
            margin-bottom: 4px;
            font-size: 14px;
            font-weight: 500;
        }
        input:focus, select:focus, textarea:focus {
            border-color: var(--accent);
            outline: none;
            box-shadow: 0 0 0 1px var(--accent);
        }
        button{padding:10px 12px;border-radius:10px;border:0;cursor:pointer}
        .btn-primary{background:var(--primary);color:var(--text-main); font-weight: 600;}
        .btn-ghost{background:transparent;border:1px solid var(--muted);color:var(--text-main)}

        /* Gaya Khusus Finance */
        .input-group-row { display: flex; gap: 8px; margin-top: 8px; }
        .input-group-col { display: flex; flex-direction: column; }
        .button-row { margin-top:10px; display:flex; gap:8px; align-items:center }
        .result-box { margin-top: 14px; }
        .bar-container { display: flex; height: 30px; border-radius: 5px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .bar-segment { text-align: center; color: white; font-size: 12px; line-height: 30px; transition: width 0.5s;}
        .bar-fixed { background-color: #007bff; }
        .bar-save { background-color: #28a745; }
        .bar-variable { background-color: var(--primary); color: var(--text-main); }
        .legend { display: flex; justify-content: space-between; margin-top: 5px; font-size: 12px; }
        .expense-list { list-style: none; padding: 0;}
        .expense-list li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
            border-bottom: 1px dashed #ccc;
        }
        .expense-list li:last-child { border-bottom: none; }
        .expense-list li button {
            background: var(--delete-red);
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
        }

        /* --- CAREER ZONE CUSTOM STYLES --- */
        #career-nav { display: flex; gap: 10px; margin-bottom: 20px; }
        #career-nav button {
            padding: 8px 14px;
            border: 1px solid var(--accent);
            background: white;
            color: var(--accent);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }
        #career-nav button.active-sub {
            background: var(--accent);
            color: white;
        }

        /* CV Builder specific styles */
        .cv-input-group > input, .cv-input-group > textarea { margin-bottom: 10px; }
        .row-univ, .row-perusahaan, .org-item {
            display: flex; align-items: center; gap: 10px; margin-bottom: 8px;
        }
        .btn-add {
            padding:5px 10px; font-size:16px; background:#28a745; color:white; border:none; border-radius:6px; cursor:pointer;
        }
        .btn-remove {
            padding:5px 10px; background:var(--delete-red); color:white; border:none; border-radius:6px; cursor:pointer;
        }

        /* Dropdown CV */
        .dropdown { position: relative; width: 100%; }
        .dropdown-btn {
            width: 100%; padding: 10px; background: white; border: 1px solid #ccc; border-radius: 6px; cursor: pointer; text-align: left; font-size: 15px; margin-top: 8px; 
        }
        .dropdown-content {
            display: none; position: absolute; background: white; width: 100%; border: 1px solid #ccc; border-radius: 6px; margin-top: 5px; z-index: 20; max-height: 150px; overflow-y: auto;
        }
        .dropdown-content div { padding: 10px; cursor: pointer; border-bottom: 1px solid #eee; }
        .dropdown-content div:hover { background: #f0f0f0; }
        
        /* CV Preview Style for PDF */
        #cvPreview {
            background: white; padding: 30px; border: 1px solid #eee; box-shadow: 0 0 10px rgba(0,0,0,0.05); min-height: 200px;
        }

        /* --- CAREER PLANNER STYLES --- */
        .category-container { display: flex; gap: 20px; margin-top: 20px; }
        .category-box { 
            background-color: #e9ecef; border-radius: 6px; flex: 1; padding-top: 20px; position: relative; 
            display: flex; flex-direction: column; min-height: 250px; 
        }
        .category-title { 
            font-size: 18px; font-weight: bold; color: #007bff; margin-bottom: 15px; padding: 0 20px; 
        }
        .upload-button { 
            position: absolute; top: 10px; right: 10px; width: 35px; height: 35px; border-radius: 50%; 
            background-color: #28a745; color: white; border: none; cursor: pointer; font-size: 16px; 
            display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); z-index: 10; 
        }

        /* --- Gaya Area Video/Daftar --- */
        .video-list-wrapper {
            flex-grow: 1; display: flex; flex-direction: column; justify-content: flex-end; 
        }

        .video-list {
            list-style: none; /* Tambahkan ini agar tidak ada bullet point */
            padding: 0;
            background-color: #f8f9fa;
            border-top: 1px solid #dee2e6;
            margin-top: 10px;
            padding: 10px;
            border-radius: 0 0 6px 6px;
            text-align: left;
        }

        .video-item {
            display: flex; align-items: center; padding: 8px 0; border-bottom: 1px dotted #ccc; 
            color: #495057; font-size: 14px; transition: background-color 0.5s;
        }
        .video-item:last-child { border-bottom: none; }
        .item-thumbnail {
            width: 40px; height: 40px; border-radius: 4px; object-fit: cover; 
            margin-right: 10px; flex-shrink: 0; 
        }
        .item-title {
            flex-grow: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
        }

        /* --- Gaya Modal --- */
        .modal { 
            display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; 
            height: 100%; overflow: auto; background-color: rgba(0, 0, 0, 0.5); padding-top: 60px; 
        }
        .modal-content { 
            background-color: #fefefe; margin: 5% auto; padding: 30px; border: 1px solid #888; 
            width: 80%; max-width: 500px; border-radius: 8px; 
        }
        .close { 
            color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; 
        }
        .upload-form label { display: block; margin-top: 10px; font-weight: bold; }
        .upload-form input { width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        .upload-form button { background-color: #007bff; color: white; padding: 10px 15px; border: none; border-radius: 4px; margin-top: 20px; cursor: pointer; }


        /* MENTAL ZONE / CHAT STYLES */
        .app-container { display: flex; flex-direction: column; width: 100%; }
        #selectCounselor { display: flex; flex-direction: column; gap: 15px; padding: 15px; background: white; border-radius: 10px; }
        .counselor-option { padding: 10px; border: 1px solid #eee; border-radius: 8px; transition: background 0.2s; }
        .counselor-option:hover { background: #f1f1f1; }
        .counselor-option label { margin: 0; font-weight: normal; cursor: pointer; display: block; }
        .start-button { background: var(--primary); color: var(--text-main); font-weight: 600; padding: 12px; border-radius: 10px; }
        #chatInterface { display: none; flex-direction: column; height: 500px; background: var(--card-bg); border-radius: 10px; overflow: hidden; }
        .chat-header { display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; background: var(--accent); color: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .konselor-info .status { font-size: 12px; color: #a4c9ff; margin-left: 5px; }
        .action-icons i { font-size: 18px; cursor: pointer; margin-left: 15px; }
        #chatBox { flex-grow: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .bubble { max-width: 70%; padding: 10px 12px; border-radius: 15px; word-wrap: break-word; }
        .bubble.me { align-self: flex-end; background-color: #dcf8c6; color: var(--text-main); border-bottom-right-radius: 0; }
        .bubble.other { align-self: flex-start; background-color: white; color: var(--text-main); border: 1px solid #eee; border-bottom-left-radius: 0; }
        .chat-input { display: flex; padding: 10px 15px; border-top: 1px solid #eee; background: white; align-items: center; }
        .input-wrapper { flex-grow: 1; margin-right: 10px; }
        .chat-input input { border-radius: 20px; padding: 8px 15px; border: 1px solid #ccc; background: #f8f8f8; }
        .mic-button { background: var(--accent); color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 16px; padding: 0; }
        /* #mental #chatInterface { display: none; } Dihapus, dikontrol di JS */


        /* FOOTER */
        footer{ margin-top:18px; text-align:center; color:var(--muted); font-size:13px }

        /* RESPONSIVE */
        @media(max-width:900px){
            .grid{grid-template-columns:1fr}
            .brand h1{font-size:16px}
            .logo-img{width:150px;height:auto;margin-right:0;}
            .category-container { flex-direction: column; }
        }
        /* ========================================= */
        /* === BAGIAN CSS END === */
        /* ========================================= */
    </style>
</head>
<body>
    <div id="particles-js"></div>

    <div class="login-box" id="login-screen" style="display:block;"> <div class="logo-container">
            <img src="img/logo vinix asisten.png" alt="Logo VINIX 7 ASISTEN">
        </div>
        <h5>Masuk ke vinix7 Asisten</h5>
        <form onsubmit="handleLogin(event)" method="post">
            <input type="text" class="form-control" name="username" placeholder="Username" required>
            <input type="password" class="form-control" name="password" placeholder="Password" required>
            <button type="submit" class="btn btn-login">LOGIN</button>
        </form>
        <div class="footer-links">
             Belum punya akun? <a href="#" onclick="showRegisterScreen(event)">Buat Akun Baru</a> 
        </div>
    </div>
    
    <div class="login-box" id="register-screen" style="display:none;">
        <div class="logo-container">
            <img src="img/logo vinix asisten.png" alt="Logo VINIX 7 ASISTEN">
        </div>
        <h5>Daftar Akun Baru</h5>
        <form onsubmit="handleRegister(event)" method="post">
            <input type="text" class="form-control" name="new_username" placeholder="Pilih Username" required>
            <input type="email" class="form-control" name="email" placeholder="Email" required>
            <input type="password" class="form-control" name="new_password" placeholder="Password" required>
            <input type="password" class="form-control" name="confirm_password" placeholder="Konfirmasi Password" required>
            <button type="submit" class="btn btn-login" style="background-color:#28a745;">REGISTER</button>
        </form>
        <div class="footer-links">
            Sudah punya akun? <a href="#" onclick="showLoginScreen(event)">Kembali ke Login</a> 
        </div>
    </div>
    
    <div class="container" id="main-content" style="display:none;">
        <header>
            <div class="brand">
                <img class="logo-img" src="img/logo vinix asisten.png" onerror="this.style.display='none'; document.getElementById('logo-text').style.display='block';" alt="Vinix Asisten Logo"> 
                <div class="logo-text" id="logo-text" style="display:none;">VINIX 7</div>
                <div>
                    <h1>Asisten Digital</h1> 
                    <div class="muted">Selamat Datang</div>
                </div>
            </div>
            <nav>
                <button class="tab active" data-tab="finance">Finance Zone</button>
                <button class="tab" data-tab="career">Career Zone</button>
                <button class="tab" data-tab="mental">Mental Zone</button>
                <button class="tab" onclick="handleLogout()">Logout</button>
            </nav>
        </header>

        <section id="finance" class="card active-section" style="display:block;">
            <div class="grid">
                <div>
                    <h2>Smart Budgeting (Visualisasi Data Sederhana)</h2>
                    <p class="muted">Masukkan pemasukan dan kategori pengeluaran — Vinix akan bantu bikin rekomendasi anggaran sederhana.</p>

                    <div class="card card-inner">
                        <label>Penghasilan Bulanan (Rp)</label>
                        <input id="income" type="number" value="5000000" />
                        
                        <div class="input-group-row">
                            <div class="input-group-col flex-1">
                                <label>Pengeluaran Tetap (Rp)</label>
                                <input id="fixed" type="number" value="2000000" />
                            </div>
                            <div class="input-group-col" style="width:140px">
                                <label>Simpanan Target (%)</label>
                                <input id="savePct" type="number" value="20" />
                            </div>
                        </div>
                        <div class="button-row">
                            <button class="btn-primary" id="calcBudget">Hitung Rekomendasi</button>
                            <button class="btn-ghost" id="resetBudget">Reset</button>
                        </div>

                        <div id="budgetResult" class="result-box"></div>
                        
                        <div id="distributionGraph" class="graph-section" style="display:none;">
                            <h4 class="graph-title">Distribusi Budget Bulanan</h4>
                            <div id="barContainer" class="bar-container">
                                <div id="fixedBar" class="bar-segment bar-fixed"></div>
                                <div id="saveBar" class="bar-segment bar-save"></div>
                                <div id="variableBar" class="bar-segment bar-variable"></div>
                            </div>
                            <div class="legend">
                                <span><span class="legend-box fixed-color" style="color:#007bff;">■</span> Tetap (<span id="fixedVal">0</span>)</span>
                                <span><span class="legend-box save-color" style="color:#28a745;">■</span> Simpanan (<span id="saveVal">0</span>)</span>
                                <span><span class="legend-box variable-color" style="color:var(--primary);">■</span> Variabel (<span id="variableVal">0</span>)</span>
                            </div>
                        </div>
                        <div id="budgetProgress" class="progress-section" style="display:none; margin-top:15px;">
                            <div class="muted">Estimasi Dana Variabel Terpakai: <b id="spentAmountDisplay">Rp 0</b></div>
                            <div class="progress-bar-container" style="height:10px; background:#e9ecef; border-radius:5px; margin-top:5px;">
                                <div id="variableProgress" class="progress-bar" style="width:0%; height:100%; background:#fd7e14; border-radius:5px;"></div>
                            </div>
                            <div class="muted progress-ratio"><span id="spentRatio">0%</span> dari Anggaran Variabel (<span id="variableBudgetDisplay">Rp 0</span>)</div>
                        </div>
                    </div>

                    <div class="card card-inner list-section">
                        <h3>Catatan Pengeluaran</h3>
                        <div class="row expense-input-row">
                            <input id="expName" placeholder="Nama pengeluaran, contoh: transport" />
                            <input id="expAmt" type="number" placeholder="Rp" />
                            <button id="addExp" class="btn-primary">Tambah</button>
                        </div>
                        <ul id="expList" class="expense-list"></ul>
                    </div>
                </div>

                <aside>
                    <div class="card">
                        <h3>Ringkasan</h3>
                        <div class="muted" id="summaryText">Belum ada perhitungan.</div>
                    </div>

                    <div class="card">
                        <h3>Tips Cepat</h3>
                        <ul class="muted tip-list" style="padding-left:15px; margin:0;">
                            <li>Mulai catat semua pengeluaran kecil selama 1 minggu.</li>
                            <li>Prioritaskan dana darurat minimal 3 bulan pengeluaran tetap.</li>
                            <li>Pakai target simpanan otomatis (20% sebagai awalan).</li>
                        </ul>
                    </div>
                </aside>
            </div>
        </section>

        <section id="career" class="card" style="display:none;">
            <h2>Career Zone</h2>
            <div id="career-nav">
                <button class="active-sub" onclick="showCareerSubPage('cv', this)">CV Builder</button>
                <button onclick="showCareerSubPage('planner', this)">Career Planner</button>
            </div>

            <div id="career-cv" class="career-sub-page">
                <h3>CV Builder</h3>

                <div class="card cv-input-group">
                    <label><b>Upload Foto</b></label>
                    <input type="file" id="fotoCV" accept="image/*" onchange="previewFoto()">
                    <img id="previewFotoCV" style="width:120px;margin-top:10px;display:none;border-radius:10px;">
                </div>

                <div class="card cv-input-group">
                    <input class="input" id="cvNama" placeholder="Nama Lengkap">
                    <input class="input" id="cvHP" placeholder="Nomor HP">
                    <input class="input" id="cvEmail" placeholder="Email">
                    <input class="input" id="cvLinkedIn" placeholder="LinkedIn">
                    <input class="input" id="cvAlamat" placeholder="Alamat">
                    <textarea class="input" id="cvDeskripsiSingkat" placeholder="Deskripsi Singkat"></textarea>
                    <textarea class="input" id="cvExtraDeskripsi" placeholder="Skill / Prestasi / Pengalaman Tambahan"></textarea>
                </div>

                <h3>Pendidikan</h3>
                <div class="card cv-input-group">
                    <div id="listUniversitas">
                        <div class="row-univ">
                            <input class="input" placeholder="Nama Sekolah / Universitas" data-type="sekolah" style="flex:1;">
                            <button onclick="tambahUniversitas(this)" class="btn-add">+</button>
                        </div>
                    </div>
                    <input class="input" id="cvAwalSekolah" placeholder="Tgl Mulai">
                    <input class="input" id="cvAkhirSekolah" placeholder="Tgl Kelulusan">
                    <input class="input" id="cvNilai" placeholder="Nilai / IPK">
                </div>

                <h3>Pengalaman Kerja</h3>
                <div class="card cv-input-group">
                    <div id="listPerusahaan">
                        <div class="row-perusahaan">
                            <input class="input" placeholder="Nama Perusahaan" data-type="perusahaan" style="flex:1;">
                            <button onclick="tambahPerusahaan(this)" class="btn-add">+</button>
                        </div>
                    </div>
                    <input class="input" id="cvAwalKerja" placeholder="Tgl Mulai">
                    <input class="input" id="cvAkhirKerja" placeholder="Tgl Berakhir">
                    <input class="input" id="cvPosisi" placeholder="Posisi">
                </div>

                <h3>Pengalaman Organisasi</h3>
                <div class="card cv-input-group">
                    <label><b>Nama Organisasi / Kegiatan</b></label>
                    <div id="listOrganisasi">
                        <div class="org-item">
                            <input class="input" placeholder="Nama Organisasi" data-type="organisasi" style="flex:1;">
                            <button onclick="tambahOrganisasi(this)" class="btn-add">+</button>
                        </div>
                    </div>
                    <input class="input" id="cvAwalOrg" placeholder="Tgl Mulai">
                    <input class="input" id="cvAkhirOrg" placeholder="Tgl Berakhir">
                    <input class="input" id="cvJabatan" placeholder="Jabatan">
                    <input class="input" id="cvPosisiOrg" placeholder="Posisi (di Organisasi)"> 
                    <input class="input" id="cvKepanitiaan" placeholder="Pengalaman Kepanitiaan">
                    <input class="input" id="cvTglAcara" placeholder="Tgl Acara">
                </div>

                <h3>Skill, Prestasi & Pengalaman Lain</h3>
                <div class="card cv-input-group">
                    <label style="margin-top:10px;"><b>Kategori</b></label>
                    <div class="dropdown" style="margin-bottom:10px;">
                        <button class="dropdown-btn" id="kategoriBtn" onclick="toggleDropdown()">Pilih Kategori</button>
                        <div class="dropdown-content" id="kategoriMenu">
                            <div onclick="pilihKategori('Lomba')">Lomba</div>
                            <div onclick="pilihKategori('Seminar')">Seminar</div>
                            <div onclick="pilihKategori('Workshop')">Workshop</div>
                        </div>
                    </div>
                    <input type="hidden" id="kategoriHasil" value="">
                    <input class="input" id="cvtahun" placeholder="Tahun">
                    <textarea class="input" id="cvDeskripsiSkill" placeholder="Deskripsi Skill / Hasil Prestasi"></textarea>
                    
                </div>
                
                <button class="btn-primary" onclick="generateCV()">Preview CV</button>
                <button class="btn-ghost" onclick="downloadPDF()" style="margin-top:10px;">Download PDF</button>

                <div class="card cv-input-group" style="margin-top:20px;">
                    <h4>Preview Output CV (A4 Portrait)</h4>
                    <div id="cvPreview" style="background:white; padding:30px; border:1px solid #eee; min-height:300px;">
                        Isi form di atas dan klik "Preview CV"
                    </div>
                </div>
            </div>

            <div id="career-planner" class="career-sub-page" style="display:none;">
                <h3>Career Planner: Learning Tracker</h3>
                <p class="muted">Catat semua sumber belajar Anda, baik dari internal Vinix maupun eksternal.</p>
                
                 <div class="category-container">
                        <div class="category-box">
                            <div class="category-title">Postingan Webinar</div>
                            <button class="upload-button" onclick="openModal('webinar')"><i class="fas fa-plus"></i></button>
                            <div class="video-list-wrapper">
                                <ul id="webinar-list" class="video-list"></ul>
                            </div>
                        </div>
                        <div class="category-box">
                            <div class="category-title">Pelatihan Vinix</div>
                            <button class="upload-button" onclick="openModal('pelatihan')"><i class="fas fa-plus"></i></button>
                            <div class="video-list-wrapper">
                                <ul id="pelatihan-list" class="video-list"></ul>
                            </div>
                        </div>
                        <div class="category-box">
                            <div class="category-title">Eksternal</div>
                            <button class="upload-button" onclick="openModal('eksternal')"><i class="fas fa-plus"></i></button>
                            <div class="video-list-wrapper">
                                <ul id="eksternal-list" class="video-list"></ul>
                            </div>
                        </div>
                 </div>
            </div>
        </section>

        <section id="mental" class="card" style="display:none;">
            <div class="grid" style="grid-template-columns:1fr;">
                <div class="app-container">
                    <div id="selectCounselor">
                        <h2>Mental Zone</h2>
                        <h3>Curhat Konselor</h3>
                        <p class="muted">Silakan pilih konselor yang sesuai dengan kebutuhan Anda:</p>
                        <div class="counselor-option">
                            <label><input type="radio" name="konselor" value="Konselor 1"> Konselor 1 (Spesialis Hubungan)</label>
                        </div>
                        <div class="counselor-option">
                            <label><input type="radio" name="konselor" value="Konselor 2"> Konselor 2 (Spesialis Kecemasan)</label>
                        </div>
                        <div class="counselor-option">
                            <label><input type="radio" name="konselor" value="Konselor 3"> Konselor 3 (Spesialis Karir)</label>
                        </div>
                        <button class="start-button" onclick="mulaiChat()">Mulai Chat</button>
                    </div>

                    <div id="chatInterface">
                        <header class="chat-header">
                            <div class="konselor-info">
                                <span class="konselor-name" id="konselorName">Pilih Konselor</span>
                                <span class="status">online</span>
                            </div>
                            <div class="action-icons">
                                <i class="fas fa-video" onclick="simulateCall('Video Call')"></i>
                                <i class="fas fa-phone" onclick="simulateCall('Telepon')"></i>
                            </div>
                        </header>
                        <main id="chatBox">
                            <div class="bubble other">
                                <span class="konselor-name-chat" style="font-weight:600;">System:</span> Selamat datang di layanan konseling. Silakan mulai percakapan.
                            </div>
                        </main>
                        <footer class="chat-input">
                            <div class="input-wrapper">
                                <input type="text" id="msg" placeholder="Mulai chat..." onkeypress="if(event.key === 'Enter') sendMsg()">
                            </div>
                            <button class="mic-button" onclick="sendMsg()">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </footer>
                    </div>
                </div>
            </div>
        </section>

        <div id="uploadModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal()">&times;</span>
                <h3 id="modalTitle">Tambah Item</h3>
                <form id="uploadForm" class="upload-form">
                    <input type="hidden" id="uploadCategory">
                    <label for="itemTitle">Judul / Nama Pelatihan:</label>
                    <input type="text" id="itemTitle" required>
                    <label for="itemFile">File/Screenshot (Opsional):</label>
                    <input type="file" id="itemFile" accept="image/*, .pdf, .doc, .docx, .xls, .xlsx">
                    <button type="submit">Simpan</button>
                </form>
            </div>
        </div>

        <footer>
            &copy; 2024 Vinix 7 Asisten Digital. All rights reserved.
        </footer>
    </div>
    
    <script>
        // =========================================
        // === BAGIAN JAVASCRIPT START (FIXED AND CONSOLIDATED) ===
        // =========================================

        let expenses = []; 
        let variableBudget = 0; 
        let activeKonselorName = ""; 
        
        // --- DEFNISI WARNA DARI CSS UNTUK DIPAKAI DI JAVASCRIPT (FIX ERROR: var() IS NOT DEFINED) ---
        const DELETE_RED_COLOR = '#dc3545';
        const VARIABLE_PROGRESS_COLOR = '#fd7e14'; // Warna default progress bar
        
        // --- DATA CAREER PLANNER YANG DIPERBAIKI ---
        let careerData = {
            webinar: [ 
                { title: "Webinar: Tren Karir 2025", icon: 'fas fa-bullhorn', color: '#ffc107' },
                { title: "Sesi Q&A 'Tips Interview'", icon: 'fas fa-users', color: '#dc3545' }
            ],
            pelatihan: [ 
                { title: "Modul Belajar Dasar AI & Machine Learning", icon: 'fas fa-book-open', color: '#1a4c90' },
                { title: "Webinar 'Membangun Personal Branding'", icon: 'fas fa-video', color: '#dc3545' }
            ],
            eksternal: [ 
                { title: "Sertifikat Pelatihan Google Digital Marketing", icon: 'fas fa-certificate', color: '#28a745' }, 
                { title: "Laporan Akhir Proyek Kampus (PDF)", icon: 'fas fa-file-pdf', color: '#007bff' }
            ]
        };
        
        // --- I. HELPER FUNCTIONS ---

        const formatRupiah = (number) => {
            return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(number);
        };

        // Fungsi baru untuk mengontrol tampilan layar (Login, Register, Main) dan Partikel
        function toggleScreens(showId, hideIds) {
            document.getElementById(showId).style.display = 'block';
            hideIds.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.style.display = 'none';
            });

            // Kontrol Partikel (hanya tampil di Login/Register)
            const isMainContent = showId === 'main-content';
            const particlesEl = document.getElementById('particles-js');
            if (particlesEl) {
                particlesEl.style.display = isMainContent ? 'none' : 'block';
            }
        }

        // Fungsi untuk konfigurasi Partikel (Bintang)
        function setupParticles() {
            if (typeof particlesJS === 'function') {
                particlesJS("particles-js", {
                    "particles": {
                        "number": { "value": 30, "density": { "enable": true, "value_area": 800 } },
                        "color": { "value": "#4c8aeb" },
                        "shape": { "type": "star" },
                        "opacity": { "value": 0.8 },
                        "size": { "value": 3, "random": true },
                        "line_linked": { "enable": false },
                        "move": { "enable": true, "speed": 1.5, "direction": "none", "random": false, "straight": false, "out_mode": "out", "bounce": false }
                    },
                    "interactivity": {
                        "detect_on": "canvas",
                        "events": { "onhover": { "enable": true, "mode": "repulse" }, "onclick": { "enable": true, "mode": "push" }, "resize": true },
                    },
                    "retina_detect": true
                });
            }
        }

        // Fungsi untuk inisialisasi Tab navigasi utama
        function setupTabs() {
            document.querySelectorAll('.tab').forEach(button => {
                button.addEventListener('click', function() {
                    const targetId = this.getAttribute('data-tab');
                    
                    // Reset semua tombol tab dan aktifkan yang diklik
                    document.querySelectorAll('.tab').forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');

                    // Sembunyikan semua section dan tampilkan target
                    document.querySelectorAll('section').forEach(section => section.style.display = 'none');
                    const targetSection = document.getElementById(targetId);
                    if(targetSection) {
                        targetSection.style.display = 'block';
                    }

                    if (targetId === 'career') {
                        // Pastikan sub-tab CV aktif saat pertama kali masuk ke Career Zone
                        const defaultSubTab = document.querySelector('#career-nav button[onclick*="\'cv\'"]');
                        if (defaultSubTab) {
                            showCareerSubPage('cv', defaultSubTab);
                        }
                        renderCareerLists(); // Pastikan data planner juga dirender saat masuk Career Zone
                    }
                    
                    if (targetId === 'mental') {
                        document.getElementById("selectCounselor").style.display = 'flex';
                        document.getElementById("chatInterface").style.display = 'none';
                    }
                });
            });
        }

        // --- II. LOGIN & REGISTER FUNCTIONS ---

        const handleLogin = (e) => {
            e.preventDefault();
            const username = e.target.username.value;
            const password = e.target.password.value;
            
            if (username && password) {
                // Simulasi Login Berhasil
                toggleScreens('main-content', ['login-screen', 'register-screen']);
                document.body.style.overflow = 'auto'; // Aktifkan scroll di konten utama
            } else {
                alert("Username dan Password harus diisi.");
            }
        };

        const handleRegister = (e) => {
            e.preventDefault();
            const username = e.target.new_username.value;
            const password = e.target.new_password.value;
            const confirmPassword = e.target.confirm_password.value;

            if (password !== confirmPassword) {
                alert("Konfirmasi password tidak cocok.");
                return;
            }

            if (username && password) {
                alert(`Akun ${username} berhasil didaftarkan. Silakan Login.`);
                // Simulasi Registrasi Berhasil, kembali ke Login
                showLoginScreen(e);
                // Optional: Isi form login dengan username baru
                document.querySelector('#login-screen input[name="username"]').value = username;
                document.querySelector('#login-screen input[name="password"]').value = '';
            } else {
                alert("Semua kolom harus diisi.");
            }
        };

        const showRegisterScreen = (e) => {
            e.preventDefault();
            toggleScreens('register-screen', ['login-screen', 'main-content']);
            document.body.style.overflow = 'hidden';
        };

        const showLoginScreen = (e) => {
            e.preventDefault();
            toggleScreens('login-screen', ['register-screen', 'main-content']);
            document.body.style.overflow = 'hidden';
        };

        const handleLogout = () => {
             // Reset state
             variableBudget = 0;
             expenses = [];
             renderExpenses();
             calculateBudget();

            toggleScreens('login-screen', ['main-content', 'register-screen']);
            document.body.style.overflow = 'hidden';
        };


        // --- III. FINANCE ZONE FUNCTIONS ---

        const calculateBudget = () => {
            const income = parseFloat(document.getElementById('income').value) || 0;
            const fixed = parseFloat(document.getElementById('fixed').value) || 0;
            const savePct = parseFloat(document.getElementById('savePct').value) || 0;
            
            const savings = income * (savePct / 100);
            variableBudget = income - fixed - savings;
            
            const summaryText = document.getElementById('summaryText');
            const resultBox = document.getElementById('budgetResult');
            const graphSection = document.getElementById('distributionGraph');
            const progressSection = document.getElementById('budgetProgress');
            
            if (income <= 0 || fixed >= income || variableBudget < 0) {
                resultBox.innerHTML = '<div style="color:red; font-weight:bold;">Perhitungan gagal. Pastikan pemasukan > pengeluaran tetap + simpanan.</div>';
                summaryText.innerHTML = 'Belum ada perhitungan.';
                graphSection.style.display = 'none';
                progressSection.style.display = 'none';
                variableBudget = 0;
            } else {
                resultBox.innerHTML = `
                    <p style="margin:0;">Simpanan Target (${savePct}%): <b>${formatRupiah(savings)}</b></p>
                    <p style="font-size:18px; font-weight:bold; color:var(--primary);">Anggaran Variabel (Max): <b>${formatRupiah(variableBudget)}</b></p>
                `;
                summaryText.innerHTML = `
                    <p>Pemasukan: <b>${formatRupiah(income)}</b></p>
                    <p>Tetap: <b>${formatRupiah(fixed)}</b></p>
                    <p>Simpanan: <b>${formatRupiah(savings)}</b></p>
                    <p>Variabel: <b>${formatRupiah(variableBudget)}</b></p>
                `;

                // Update Graph
                const total = income;
                const fixedWidth = (fixed / total) * 100;
                const saveWidth = (savings / total) * 100;
                const variableWidth = (variableBudget / total) * 100;

                document.getElementById('fixedBar').style.width = `${fixedWidth}%`;
                document.getElementById('saveBar').style.width = `${saveWidth}%`;
                document.getElementById('variableBar').style.width = `${variableWidth}%`;
                
                document.getElementById('fixedBar').textContent = fixedWidth > 5 ? 'Tetap' : '';
                document.getElementById('saveBar').textContent = saveWidth > 5 ? 'Save' : '';
                document.getElementById('variableBar').textContent = variableWidth > 5 ? 'Variabel' : '';

                document.getElementById('fixedVal').textContent = formatRupiah(fixed);
                document.getElementById('saveVal').textContent = formatRupiah(savings);
                document.getElementById('variableVal').textContent = formatRupiah(variableBudget);
                
                graphSection.style.display = 'block';
                progressSection.style.display = 'block';
            }
            updateProgress();
        };

        const resetBudget = () => {
            document.getElementById('income').value = '5000000';
            document.getElementById('fixed').value = '2000000';
            document.getElementById('savePct').value = '20';
            expenses = [];
            renderExpenses();
            calculateBudget();
        };

        window.addExpense = function() { // Dibuat window function agar dapat dipanggil dari DOM
            const name = document.getElementById('expName').value.trim();
            const amount = parseFloat(document.getElementById('expAmt').value) || 0;
            
            if (name && amount > 0) {
                expenses.push({ name, amount });
                document.getElementById('expName').value = '';
                document.getElementById('expAmt').value = '';
                renderExpenses();
            } else {
                alert('Nama dan Jumlah Pengeluaran harus diisi.');
            }
        };

        window.deleteExpense = function(index) {
            expenses.splice(index, 1);
            renderExpenses();
        };

        const renderExpenses = () => {
            const list = document.getElementById('expList');
            list.innerHTML = '';
            let totalSpent = 0;
            
            if (expenses.length === 0) {
                list.innerHTML = `<li style="text-align:center; color:var(--muted);">Belum ada pengeluaran dicatat.</li>`;
            }

            expenses.forEach((exp, index) => {
                totalSpent += exp.amount;
                const li = document.createElement('li');
                li.innerHTML = `
                    <span>${exp.name}: <b>${formatRupiah(exp.amount)}</b></span>
                    <button onclick="deleteExpense(${index})">Hapus</button>
                `;
                list.appendChild(li);
            });
            
            updateProgress(totalSpent);
        };

        const updateProgress = (totalSpent = 0) => {
            if (expenses.length > 0) {
                totalSpent = expenses.reduce((sum, exp) => sum + exp.amount, 0);
            }
            
            const spentDisplay = document.getElementById('spentAmountDisplay');
            const budgetDisplay = document.getElementById('variableBudgetDisplay');
            const progressBar = document.getElementById('variableProgress');
            const spentRatio = document.getElementById('spentRatio');
            
            spentDisplay.textContent = formatRupiah(totalSpent);
            budgetDisplay.textContent = formatRupiah(variableBudget);
            
            let percentage = (variableBudget > 0) ? (totalSpent / variableBudget) * 100 : 0;
            percentage = Math.min(percentage, 100); 

            progressBar.style.width = `${percentage}%`;
            // Perbaikan agar rasio tampil dengan format yang lebih baik
            const roundedRatio = Math.round((totalSpent / variableBudget) * 1000) / 10; 
            spentRatio.textContent = `${Math.min(roundedRatio, 100)}%`; 
            
            // --- FIX ERROR: Penggunaan var() di JavaScript yang salah ---
            if (totalSpent > variableBudget) {
                progressBar.style.background = DELETE_RED_COLOR; 
            } else {
                progressBar.style.background = VARIABLE_PROGRESS_COLOR; 
            }
            // --- END FIX ---
        };


        // --- IV. CAREER ZONE (CV BUILDER) FUNCTIONS ---

        // Fungsi umum untuk toggle dropdown
        window.toggleDropdown = function() {
            document.getElementById("kategoriMenu").style.display = 
                document.getElementById("kategoriMenu").style.display === "block" ? "none" : "block";
        };

        // Fungsi untuk memilih kategori dropdown
        window.pilihKategori = function(kategori) {
            document.getElementById("kategoriBtn").textContent = kategori;
            document.getElementById("kategoriHasil").value = kategori;
            toggleDropdown();
        };

        // Fungsi untuk Preview Foto
        window.previewFoto = function() {
            const file = document.getElementById('fotoCV').files[0];
            const preview = document.getElementById('previewFotoCV');

            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                }
                reader.readAsDataURL(file);
            } else {
                preview.style.display = 'none';
            }
        }
        
        // Fungsi Tambah Input (untuk Pendidikan, Kerja, Organisasi)
        function createNewInputRow(listId, placeholderText, dataType) {
            const list = document.getElementById(listId);
            const row = document.createElement('div');
            row.className = dataType === 'organisasi' ? 'org-item' : (dataType === 'sekolah' ? 'row-univ' : 'row-perusahaan');
            row.innerHTML = `
                <input class="input" placeholder="${placeholderText}" data-type="${dataType}" style="flex:1;">
                <button onclick="removeRow(this)" class="btn-remove">-</button>
            `;
            list.appendChild(row);
        }

        window.tambahUniversitas = function(button) {
            createNewInputRow('listUniversitas', 'Nama Sekolah / Universitas', 'sekolah');
            button.textContent = '+';
            button.onclick = function() { tambahUniversitas(this); };
        };

        window.tambahPerusahaan = function(button) {
            createNewInputRow('listPerusahaan', 'Nama Perusahaan', 'perusahaan');
            button.textContent = '+';
            button.onclick = function() { tambahPerusahaan(this); };
        };

        window.tambahOrganisasi = function(button) {
            createNewInputRow('listOrganisasi', 'Nama Organisasi', 'organisasi');
            button.textContent = '+';
            button.onclick = function() { tambahOrganisasi(this); };
        };

        window.removeRow = function(button) {
            button.parentElement.remove();
        };

        // Fungsi Generate CV
        window.generateCV = function() {
            const nama = document.getElementById('cvNama').value;
            const hp = document.getElementById('cvHP').value;
            const email = document.getElementById('cvEmail').value;
            const linkedin = document.getElementById('cvLinkedIn').value;
            const alamat = document.getElementById('cvAlamat').value;
            const deskripsiSingkat = document.getElementById('cvDeskripsiSingkat').value.replace(/\n/g, '<br>');
            const extraDeskripsi = document.getElementById('cvExtraDeskripsi').value.replace(/\n/g, '<br>');
            const fotoUrl = document.getElementById('previewFotoCV').src;

            let cvContent = `
                <div style="font-family:'Poppins', sans-serif; padding:15px; border:none;">
                    <table style="width:100%; border-bottom:3px solid var(--accent); margin-bottom:15px;">
                        <tr>
                            <td>
                                <h2 style="color:var(--vinix-blue-dark); margin:0;">${nama || 'Nama Lengkap Anda'}</h2>
                                <p style="font-size:14px; color:var(--muted); margin: 5px 0 10px 0;">${alamat || 'Alamat Anda'}</p>
                            </td>
                            <td style="text-align:right; width:120px;">
                                ${document.getElementById('previewFotoCV').style.display === 'block' ? 
                                    `<img src="${fotoUrl}" style="width:100px; height:100px; object-fit:cover; border-radius:50%; border:3px solid var(--accent);">` 
                                    : ''}
                            </td>
                        </tr>
                    </table>

                    <div style="font-size:14px; margin-bottom:15px; line-height:1.4;">${deskripsiSingkat || 'Tulis deskripsi singkat Anda di sini.'}</div>
                    
                    ${generateContactSection(hp, email, linkedin)}
                    ${generateEducationSection()}
                    ${generateExperienceSection()}
                    ${generateOrganizationSection()}
                    ${generateSkillsSection(extraDeskripsi)}
                    ${generateKategoriSection()}
                </div>
            `;

            document.getElementById('cvPreview').innerHTML = cvContent;
        };

        function generateContactSection(hp, email, linkedin) {
            return `
                <h3 style="color:var(--accent); border-bottom:1px solid #ddd; padding-bottom:5px; font-size:16px;">Kontak</h3>
                <div style="font-size:13px; margin-top:5px;">
                    ${hp ? `<p style="margin:0;"><i class="fas fa-phone-alt" style="width:20px;"></i> ${hp}</p>` : ''}
                    ${email ? `<p style="margin:0;"><i class="fas fa-envelope" style="width:20px;"></i> ${email}</p>` : ''}
                    ${linkedin ? `<p style="margin:0;"><i class="fab fa-linkedin" style="width:20px;"></i> <a href="${linkedin}" target="_blank" style="color:var(--text-main); text-decoration:none;">${linkedin}</a></p>` : ''}
                </div>
            `;
        }

        function generateEducationSection() {
            const universitasInputs = document.querySelectorAll('#listUniversitas input[data-type="sekolah"]');
            const listUniv = Array.from(universitasInputs).map(input => input.value).filter(val => val.trim() !== '');

            const awal = document.getElementById('cvAwalSekolah').value;
            const akhir = document.getElementById('cvAkhirSekolah').value;
            const nilai = document.getElementById('cvNilai').value;
            
            if (listUniv.length === 0 && !awal && !akhir && !nilai) return '';

            let html = `<h3 style="color:var(--accent); border-bottom:1px solid #ddd; padding-bottom:5px; font-size:16px; margin-top:15px;">Pendidikan</h3><ul style="list-style:disc; padding-left:20px; font-size:14px;">`;
            
            listUniv.forEach(univ => {
                 html += `<li><b>${univ}</b><br><span style="color:var(--muted);">${awal || 'Tgl Mulai'} - ${akhir || 'Tgl Lulus'} | IPK/Nilai: ${nilai || '-'}</span></li>`;
            });

            html += `</ul>`;
            return html;
        }

        function generateExperienceSection() {
            const perusahaanInputs = document.querySelectorAll('#listPerusahaan input[data-type="perusahaan"]');
            const listPerusahaan = Array.from(perusahaanInputs).map(input => input.value).filter(val => val.trim() !== '');

            const awal = document.getElementById('cvAwalKerja').value;
            const akhir = document.getElementById('cvAkhirKerja').value;
            const posisi = document.getElementById('cvPosisi').value;
            
            if (listPerusahaan.length === 0 && !awal && !akhir && !posisi) return '';

            let html = `<h3 style="color:var(--accent); border-bottom:1px solid #ddd; padding-bottom:5px; font-size:16px; margin-top:15px;">Pengalaman Kerja</h3><ul style="list-style:disc; padding-left:20px; font-size:14px;">`;
            
            listPerusahaan.forEach(perusahaan => {
                 html += `<li><b>${posisi || 'Posisi'}</b> di ${perusahaan}<br><span style="color:var(--muted);">${awal || 'Tgl Mulai'} - ${akhir || 'Tgl Berakhir'}</span></li>`;
            });

            html += `</ul>`;
            return html;
        }
        
        function generateOrganizationSection() {
            const organisasiInputs = document.querySelectorAll('#listOrganisasi input[data-type="organisasi"]');
            const listOrganisasi = Array.from(organisasiInputs).map(input => input.value).filter(val => val.trim() !== '');
            
            const awal = document.getElementById('cvAwalOrg').value;
            const akhir = document.getElementById('cvAkhirOrg').value;
            const jabatan = document.getElementById('cvJabatan').value;
            const posisiOrg = document.getElementById('cvPosisiOrg').value;
            const kepanitiaan = document.getElementById('cvKepanitiaan').value;
            const tglAcara = document.getElementById('cvTglAcara').value;

            if (listOrganisasi.length === 0 && !awal && !akhir && !jabatan && !posisiOrg && !kepanitiaan) return '';

            let html = `<h3 style="color:var(--accent); border-bottom:1px solid #ddd; padding-bottom:5px; font-size:16px; margin-top:15px;">Pengalaman Organisasi & Kepanitiaan</h3><ul style="list-style:disc; padding-left:20px; font-size:14px;">`;

            listOrganisasi.forEach(org => {
                html += `<li><b>${org}</b> (${jabatan || 'Jabatan'})<br><span style="color:var(--muted);">${awal || 'Tgl Mulai'} - ${akhir || 'Tgl Berakhir'} | Posisi: ${posisiOrg || '-'}</span></li>`;
            });
            
            if (kepanitiaan) {
                html += `<li><b>Kepanitiaan: ${kepanitiaan}</b><br><span style="color:var(--muted);">Tgl Acara: ${tglAcara || 'T/A'}</span></li>`;
            }

            html += `</ul>`;
            return html;
        }

        function generateSkillsSection(extraDeskripsi) {
             if (!extraDeskripsi) return '';
             return `
                <h3 style="color:var(--accent); border-bottom:1px solid #ddd; padding-bottom:5px; font-size:16px; margin-top:15px;">Skill & Pengalaman Tambahan</h3>
                <div style="font-size:14px; margin-top:5px; line-height:1.4;">${extraDeskripsi}</div>
            `;
        }

        function generateKategoriSection() {
            const kategori = document.getElementById('kategoriHasil').value;
            const tahun = document.getElementById('cvtahun').value;
            const deskripsiSkill = document.getElementById('cvDeskripsiSkill').value.replace(/\n/g, '<br>');

            if (!kategori && !tahun && !deskripsiSkill) return '';
            
            let html = `<h3 style="color:var(--accent); border-bottom:1px solid #ddd; padding-bottom:5px; font-size:16px; margin-top:15px;">Prestasi / Sertifikasi Lain</h3><ul style="list-style:disc; padding-left:20px; font-size:14px;">`;
            
            html += `<li><b>${kategori || 'Kategori'} (${tahun || 'Tahun'})</b><br><span style="color:var(--muted);">${deskripsiSkill || 'Deskripsi'}</span></li>`;
            
            html += `</ul>`;
            return html;
        }
        
        // Fungsi Download PDF
        window.downloadPDF = function() {
            generateCV(); // Pastikan preview terbaru ter-generate
            const element = document.getElementById('cvPreview');
            const opt = {
                margin: 0.5,
                filename: 'CV_Vinix7_Asisten.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'in', format: 'A4', orientation: 'portrait' }
            };
            
            // Panggil html2pdf
            html2pdf().set(opt).from(element).save();
        };

        // Fungsi untuk mengontrol sub-tab Career Zone
        window.showCareerSubPage = function(subPageId, button) {
            document.querySelectorAll('.career-sub-page').forEach(page => {
                page.style.display = 'none';
            });
            document.getElementById(`career-${subPageId}`).style.display = 'block';

            document.querySelectorAll('#career-nav button').forEach(btn => {
                btn.classList.remove('active-sub');
            });
            button.classList.add('active-sub');
        }


        // --- V. CAREER PLANNER FUNCTIONS (FIXED) ---

        // FUNGSI INTI UNTUK MERENDER SEMUA LIST
        window.renderCareerLists = function() {
            // Loop melalui ketiga kategori
            ['webinar', 'pelatihan', 'eksternal'].forEach(category => {
                const listEl = document.getElementById(`${category}-list`);
                listEl.innerHTML = '';
                
                if (careerData[category].length === 0) {
                    listEl.innerHTML = `<li style="text-align:center; color:var(--muted); padding:10px;">Belum ada data. Klik + untuk menambah.</li>`;
                    return;
                }

                careerData[category].forEach(item => {
                    const li = document.createElement('li');
                    li.className = 'video-item';
                    let iconHtml = '';
                    
                    // Logika tampilan icon/thumbnail
                    if (item.previewImage) {
                        iconHtml = `<img src="${item.previewImage}" class="item-thumbnail" alt="Preview">`;
                    } else if (item.icon) {
                        // Tampilkan ikon Font Awesome
                        li.style.cursor = 'pointer'; 
                        li.setAttribute('title', item.title);
                        iconHtml = `<i class="${item.icon}" style="font-size:20px; margin-right:10px; color:${item.color || '#333'};"></i>`;
                    } else {
                        // Default icon jika tidak ada info
                        li.style.cursor = 'pointer';
                        iconHtml = `<i class="fas fa-file" style="font-size:20px; margin-right:10px; color:#333;"></i>`;
                    }

                    li.innerHTML = `
                        ${iconHtml}
                        <span class="item-title">${item.title}</span>
                    `;
                    listEl.appendChild(li);
                });
            });
        }
        
        window.openModal = function(category) {
            document.getElementById('uploadCategory').value = category;
            let titleText = 'Tambah Item';
            
            if (category === 'webinar') { 
                titleText = 'Tambah Item Postingan Webinar';
            } else if (category === 'pelatihan') {
                titleText = 'Tambah Item Pelatihan Internal Vinix';
            } else if (category === 'eksternal') {
                titleText = 'Tambah Item Pembelajaran Eksternal';
            }
            
            document.getElementById('modalTitle').textContent = titleText;
            document.getElementById('uploadModal').style.display = 'block';
            document.getElementById('uploadForm').reset();
        };

        window.closeModal = function() {
            document.getElementById('uploadModal').style.display = 'none';
        };

        // Handle Form Submit (Diperbaiki untuk memasukkan data ke category yang benar)
        document.getElementById('uploadForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const category = document.getElementById('uploadCategory').value;
            const name = document.getElementById('itemTitle').value.trim();
            const fileInput = document.getElementById('itemFile');
            const file = fileInput.files[0];

            const iconMap = {
                'image': 'fas fa-image',
                'pdf': 'fas fa-file-pdf',
                'doc': 'fas fa-file-word',
                'xls': 'fas fa-file-excel',
                'other': 'fas fa-file',
                'video': 'fas fa-video', 
            };

            let fileInfo = { type: 'other', color: '#6c757d' }; // Default 
            
            // 1. Tentukan tipe file jika ada
            if (file) {
                const mime = file.type;
                if (mime.startsWith('image/')) {
                    fileInfo.type = 'image';
                } else if (mime.includes('pdf')) {
                    fileInfo.type = 'pdf';
                    fileInfo.color = '#dc3545';
                } else if (mime.includes('word') || mime.includes('doc')) {
                    fileInfo.type = 'doc';
                    fileInfo.color = '#007bff';
                } else if (mime.includes('excel') || mime.includes('xls')) {
                    fileInfo.type = 'xls';
                    fileInfo.color = '#28a745';
                }
            } else {
                // 2. Tentukan default icon jika TIDAK ADA file
                if (category === 'webinar') {
                    fileInfo.type = 'video';
                    fileInfo.color = '#007bff'; // Biru default untuk video
                } else if (category === 'pelatihan') {
                    fileInfo.type = 'video';
                    fileInfo.color = '#1a4c90'; // Biru Vinix untuk pelatihan internal
                }
            }

            if (name) {
                // Handle file gambar (untuk preview thumbnail)
                if (fileInfo.type === 'image' && file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        if (careerData[category]) {
                            careerData[category].push({
                                title: name,
                                previewImage: event.target.result // simpan base64 thumbnail
                            });
                        }
                        renderCareerLists();
                        closeModal();
                    };
                    reader.readAsDataURL(file);
                } else {
                    // Handle non-image files atau jika tidak ada file
                    if (careerData[category]) {
                        careerData[category].push({
                            title: name,
                            icon: iconMap[fileInfo.type] || iconMap['other'],
                            color: fileInfo.color 
                        });
                    }
                    renderCareerLists();
                    closeModal();
                }
            } else {
                alert('Harap isi Judul.');
            }
        });


         // =========================================
        // --- 3. MENTAL ZONE SCRIPT (Chat) ---
        // =========================================

        const responses = {
            "halo": "Halo, saya mendengarkan. Apa yang sedang kamu rasakan?",
            "hai": "Hai, aku di sini untuk membantu kamu.",
            "sedih": "Perasaan sedih itu valid. Mau cerita lebih dalam? Aku siap mendengarkan.",
            "capek": "Kelelahan emosional itu nyata. Apa yang bikin kamu merasa capek? Fokus pada satu hal.",
            "marah": "Kemarahan sering muncul dari tekanan. Apa pemicunya menurutmu? Mari kita bahas perlahan.",
            "sendiri": "Perasaan sendiri memang berat. Tapi kamu tidak sendiri sekarang. Apa yang bisa aku bantu?",
            "stres": "Stres memang berat di kepala. Apa penyebab paling besar menurutmu? Mari kita cari solusinya.",
            "terimakasih": "Sama-sama. Aku selalu siap bantu kamu. Ada lagi?",
            "makasih": "Dengan senang hati membantu. Jangan ragu untuk berbagi lagi.",
            "takut": "Rasa takut sering muncul dari pikiran yang belum pasti. Apa yang membuatmu takut? Aku di sini.",
            "hubungan": "Masalah hubungan memang rumit. Bagaimana situasinya saat ini?",
            "kerja": "Tuntutan pekerjaan sering menekan. Apakah ini masalah beban atau ekspektasi?",
            "sekolah": "Pendidikan adalah tantangan. Apa yang paling membuatmu tertekan di sekolah?"
        };

        window.mulaiChat = function() {
            let konselorRadio = document.querySelector("input[name='konselor']:checked");
            
            if (!konselorRadio) { 
                alert("Pilih konselor dulu sebelum memulai chat!"); 
                return; 
            }

            activeKonselorName = konselorRadio.value;

            document.getElementById("konselorName").innerText = activeKonselorName;
            
            let box = document.getElementById("chatBox");
            box.innerHTML = ''; 
            
            let initialBubble = document.createElement("div");
            initialBubble.className = "bubble other";
            initialBubble.innerHTML = `Halo, saya ${activeKonselorName}. Saya siap mendengarkan. Apa yang ingin Anda bicarakan hari ini?`;
            box.appendChild(initialBubble);
            box.scrollTop = box.scrollHeight;

            document.getElementById("selectCounselor").style.display = 'none';
            document.getElementById("chatInterface").style.display = 'flex'; 
            
            document.getElementById("msg").focus();
        };

        window.sendMsg = function() {
            let text = document.getElementById("msg").value;
            if (text.trim() === "") return;

            let box = document.getElementById("chatBox");

            // 1. Pesan Pengguna
            let userBubble = document.createElement("div");
            userBubble.className = "bubble me";
            userBubble.innerText = text;
            box.appendChild(userBubble);
            box.scrollTop = box.scrollHeight;

            document.getElementById("msg").value = "";
            document.getElementById("msg").focus();

            // 2. Respon Konselor (Simulasi)
            let lower = text.toLowerCase();
            let reply = "";
            const konselorName = activeKonselorName || document.getElementById("konselorName").innerText;

            for (let key in responses) {
                if (lower.includes(key)) {
                    reply = responses[key];
                    break;
                }
            }

            if (reply === "") {
                reply = "Terima kasih atas sharingnya. Bisakah Anda jelaskan lebih detail tentang (perasaan) yang timbul dari situasi tersebut? Ceritakan lebih banyak agar saya bisa memahami.";
            }

            setTimeout(() => {
                let botBubble = document.createElement("div");
                botBubble.className = "bubble other";
                botBubble.innerHTML = `${konselorName}: ${reply}`;
                box.appendChild(botBubble);

                box.scrollTop = box.scrollHeight;
            }, 900); 
        };

        window.simulateCall = function(type) {
            const currentKonselorName = activeKonselorName || document.getElementById("konselorName").innerText;
            
            if(currentKonselorName === ""){
                alert("Harap pilih konselor terlebih dahulu!");
                return;
            }
            alert(`Simulasi ${type} ke ${currentKonselorName} akan segera dimulai. (Fitur ini hanya simulasi tampilan)`);
        };
        
        // --- EVENT LISTENERS INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            setupTabs();
            
            // Finance Zone Listeners
            document.getElementById('calcBudget').addEventListener('click', calculateBudget);
            document.getElementById('addExp').addEventListener('click', window.addExpense);
            document.getElementById('resetBudget').addEventListener('click', resetBudget);

            // Inisialisasi Finance Zone
            calculateBudget();
            renderExpenses();
            renderCareerLists();
        });
        
    </script>
</body>
</html>